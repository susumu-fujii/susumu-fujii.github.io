---
title: 'バンド構造とDOSを計算してみよう'
date: '2024-04-30'
private: true
---

### 電子バンド構造とDOS
より本格的に電子構造を理解するために、バンド構造とDOSの計算をしてみましょう。
この計算を行うためには、普通の構造最適化で得られた構造（CONTCAR）と電荷密度（CHGCAR）が必要です。
electronic_structure/01_charge_density/bazro3/normalの中身を、electronic_structure/03_band_dos/BaZrO3/01_optの中にコピーして、そのディレクトリに移動して下さい。
次に、CONTCARを自分のPCにダウンロードして下さい。

電子の状態は、逆格子空間で考えるのが便利です。
[SeeK-path](https://www.materialscloud.org/work/tools/seekpath)を開いて、CONTCARを選択し、file formatをVASP POSCARにして「calculate my structure」をしてみて下さい。
しばらくすると、BaZrO3の第一ブリルアンゾーンと対応するプリミティブ・セルが表示されると思います。
ブリルアンゾーンの中でも対称性が高い点に、X、Mなどの記号が付けられています。
この対称性の高い点に沿ってバンドのエネルギーを計算したものがバンド構造です。
これを見ることで、電子構造の特徴が分かります（あとで例を取って説明します）。
よく分からないかもしれませんが、とりあえず計算してイメージを付けましょう。
先ほどのSeeK-pathのページの下に、「VASP KPOINTS input for LDA/GGA」とあると思います。
まずそれをコピーして下さい。
コピーしたら、02_bandの中に移動して、

```bash
vim KPOINTS
```

として、コピーした内容を貼り付けて下さい。
（そのまま貼り付けると勝手に段落付けしてしまうので、貼り付ける前に:set no autoindentと打って、Enterして下さい。）
<...>の部分を51に置き換えて、保存して下さい。
あと、

```
    0.0000000000     0.0000000000     0.0000000000 1   GAMMA
    0.0000000000     0.5000000000     0.0000000000 1   X
```
となっているのを、

```
    0.0000000000     0.0000000000     0.0000000000  \Gamma
    0.0000000000     0.5000000000     0.0000000000  X
```

という感じに直しといて下さい（1を消して、GAMMAの前にバックスラッシュ（\）をつけて、GAMMAをGammaに変える。)
（vimの矩形選択を覚えると1を一気に消せます。また、置換を覚えるとGAMMAを\Gammaに一気に変換できます。興味があれば調べて下さい。）


その後、01_optからgo.sh、INCAR、POTCAR、CONTCAR、**CHGCAR**をコピーしてきて、CONTCARをPOSCARに改名して下さい。
終わったら、INCARを以下のように変更して、計算を回して下さい。

```
NSW        =  300 ->
NSW        =  0

#ICHARG    =  2 ->
ICHARG    =  11

LORBIT    =  11 #最後に付け足す
```

計算を回し終わったら、DOSの計算も同時に始めましょう。
先ほどのバンド構造の計算では、ブリルアンゾーンの中の対称性の高い点の間のエネルギー準位を計算しました。
要するに、ブリルアンゾーンの一部を抜き出すことで、その特徴を理解しようというものです。
しかし実際には、電子のエネルギー準位は対称性の低い点でも刻々と変化します。
なので電子状態の全体像を知るためには、ブリルアンゾーン全体のエネルギー準位を算出する必要があります。
このエネルギー準位の数をエネルギーの関数としてプロットしたのが電子状態密度（density of states; DOS）です。

03_dosに移動して、01_optからgo.sh、INCAR、POTCAR、KPOINTS、CONTCAR、**CHGCAR**をコピーして、CONTCARをPOSCARに改名して下さい。
ここで、vimコマンドでKPOINTSを開いてみて下さい。
以下のような感じになっていると思います。

```
Automatic
0
Monkhorst-Pack
5  5  5
0. 0. 0.
```

今まで説明してませんでしたが、通常の構造最適化やDOS計算で使うKPOINTSの中身はこんな感じです。
さっき見たようなブリルアンゾーンを、この場合5x5x5のメッシュに分割し、各逆格子点のエネルギーを計算しています。
構造最適化の時には系全体のエネルギーがある程度正確に求まれば良いので、これくらいの粗いメッシュでも大丈夫です。
ただしDOSを出す時は高精度にエネルギー準位の数を求めたいので、メッシュをかなり細かくします。
以下の内容に書き換えて下さい。

```
Automatic
0
Gamma
19 19 19
0. 0. 0.
```

本当は無限にメッシュを細かくするのが理想ですが、計算コストとの兼ね合いでちょうど良い値を決めます。
INCARは以下のように書き換えて下さい。

```
NSW        =  300 ->
NSW        =  0

#ICHARG    =  2 ->
ICHARG    =  11

ISMEAR     =  0 ->
ISMEAR     =  -5

LORBIT     =  11     #最後に付け足す
EMIN       =  -20.0  #最後に付け足す
EMAX       =  20.0   #最後に付け足す
NEDOS      =  4001   #最後に付け足す
```

DOSの計算方法や、どのくらいのエネルギー範囲のDOSを計算するかを決めています。
修正が終わったら計算を回して下さい。
計算も終わったら、一つ前のディレクトリに戻って、以下のスクリプトを回して下さい。

```bash
python ~/SCRIPT/plot_band_dos.py
```

そうすると、eband_dos.pngというファイルが出来ます。
これにバンド構造とDOSが描かれているはずです。

左に見えるのがバンド構造です。
対称性の高い点同士を結び、その間のエネルギー準位を見ています。
縦軸がエネルギーで、0がフェルミエネルギーになるように補正されています。
右に見えるのがDOSです。
対称性の高いところだけでなく、ブリルアンゾーン全体でのエネルギー準位の数（密度）が横軸になっています。
ギャップが大きく空いているので、BaZrO3は絶縁体です（普通の第一原理計算だとバンドギャップを過小評価するので注意して下さい。実験値と比べてみたら分かります。）

バンドが傾いていると思いますが、これを分散といいます。
線の傾きは電子の群速度を表しています。
なので、分散が大きいほど、電子が移動しやすく、非局在化しています。
逆に、分散が小さいほど、電子は移動しにくく、強く局在化しています（ある部分に束縛されている）。
電子伝導度はキャリアの電子の数とその移動度の掛け算で表せるので、フェルミエネルギー近傍のDOSが大きく、かつバンドの分散が大きければ電子伝導度が高いことになります。

### H2OとAlの場合

もっと極端な例をみて、イメージを付けましょう。
03_band_dosのディレクトリの中に、H2OとAlも用意しています。
H2Oについては、01_charge_density/H2O/normalの中身を01_optにコピーして、BaZrO3と同じ手順で計算してみて下さい。

Alについても同様ですが、バンド構造とDOSの計算ではプリミティブセルを使う必要があります。
とりあえず、01_charge_density/Al/normalの入力ファイルとCONTCARを01_optにコピーして下さい。
そこで、

```bash
phonopy --symmetry -c CONTCAR
```

とやってみて下さい。
こうすると、CONTCARを読み込んで自動的に空間群など対称性を調べて、ブラベー格子（BPOSCAR; conventional cell）とプリミティブセル（PPOSCAR; primitive cell）を出力してくれます。
PPOSCARをPOSCARに置き換えて、構造最適化を回して下さい。
その後はBaZrO3やH2Oの手順と同様です。

これらを比較すると本当に電子構造が全然違うのが分かると思います。

{{% callout note %}}
{{< spoiler text="ちなみに">}}
バンド構造とDOSの図示には、pymatgenを使ってます。
{{< /spoiler >}}
{{% /callout %}}

とりあえず第一原理計算を体験することが目的の人は一旦ここまでで良いと思います。
Materials Projectから構造をダウンロードして、POTCARを用意したりすれば、どんな化合物でも電子構造の計算くらいは出来るはずです。
（本当はINCARとKPOINTSの条件をちゃんと決めないといけないので、やりたければ聞いて下さい。）

いちいちファイル編集したりするのが面倒臭いと感じた人は[プログラミング](/programming/for_beginners/)の才能がありますので、是非試して下さい :smile:
