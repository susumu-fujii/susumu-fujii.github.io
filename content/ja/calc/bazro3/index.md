---
title: 'BaZrO3の計算をしてみよう'
date: '2024-04-24'
private: true
---

### 単純な計算をしてみよう
コピーしたbasicの中に、energyというディレクトリがあると思います。
この中にある、01_optimizationというディレクトリに移動してください。
lsしてみると、以下のファイルが入っていると思います。

```bash
go.sh  INCAR  KPOINTS  POSCAR  POTCAR
```

この中の、INCAR、KPOINTS、POSCAR、POTCARというのが、VASPというソフトで第一原理計算を行うのに必要なファイルです。
INCARとKPOINTSは計算条件、POTCARは元素の内殻電子の情報（擬ポテンシャル）、POSCARは計算する材料の元素種と構造を指定するものです。
INCAR、KPOINTS、POTCARは一旦置いといて、POSCARの中身は以下のような感じです。

```bash
 Ba1 Zr1 O3                 #（タイトル; 何書いてもいい）
 1.0                        #（格子ベクトルの係数）
 5.000000 0.000000 0.000000 #（a軸）
 0.000000 5.000000 0.000000 #（b軸）
 0.000000 0.000000 5.000000 #（c軸）
 Ba Zr O                    #（元素名）
 1 1 3                      #（各元素の数）
 direct                     #（まだ気にしなくていい）
 0.500000 0.500000 0.500000 #（１個目の原子の相対座標、以下同）
 0.000000 0.000000 0.000000
 0.000000 0.000000 0.500000
 0.000000 0.500000 0.000000
 0.500000 0.000000 0.000000
```

このPOSCARは、BaZrO3の構造を表しています（格子定数はわざと変な値にしてます）。
ちなみに、この[POSCAR](POSCAR)というファイルは[VESTA](https://jp-minerals.org/vesta/jp/)というソフトで可視化できるので、まだやったことがなければそちらを先にやってみてください。

とりあえず他のファイルの中身はまだ分かってなくていいので、計算を回してみましょう。
以下のコマンドを実行します。

```bash
qsub go.sh
```

これを行うと、martlet01のジョブ管理システムにgo.shが投入されます。
こんな出力があるはずです。
```bash
Your job 10366 ("BaZrO3") has been submitted
```
10366という番号で、ジョブが管理システムに投入されたことを意味してます。
ジョブ管理システムはmartlet02-20の中で空いている計算機を見つけて、自動で計算を行ってくれます。
ジョブの状態は、以下のコマンドを入力すれば見れます。

```bash
qstat
```

こんな出力が現れるはずです。

```bash
job-ID  prior   name       user         state submit/start at     queue                          slots ja-task-ID
-----------------------------------------------------------------------------------------------------------------
  10366 0.70000 BaZrO3     xxxx         qw    05/02/2024 10:05:43                                   64
```

ここで重要なのはstateです。
qwは計算機の空き待ち、rは計算実行中です。
その他の場合、なんかをミスっていて計算がうまくいってません。
計算が終わったら、qstatから該当のジョブが消えます。

一旦計算が始まると、何やらディレクトリの中にファイルがいっぱい増えていると思います。
特によく見るのは、vasp.log、OUTCAR、CONTCARです。
vasp.logの中身をlessコマンドで見てみてください。
以下のような感じになっているはずです。

```
       N       E                     dE             d eps       ncg     rms          rms(c)
DAV:   1     0.343090495196E+03    0.34309E+03   -0.20775E+04   480   0.159E+03
DAV:   2    -0.215661650220E+02   -0.36466E+03   -0.35720E+03   688   0.347E+02
DAV:   3    -0.456701152037E+02   -0.24104E+02   -0.24076E+02   664   0.987E+01
DAV:   4    -0.466700822431E+02   -0.99997E+00   -0.99943E+00   792   0.146E+01
DAV:   5    -0.466822617676E+02   -0.12180E-01   -0.12179E-01   672   0.151E+00    0.168E+01
DAV:   6    -0.377895973980E+02    0.88927E+01   -0.80965E+01   648   0.375E+01    0.111E+01
DAV:   7    -0.370217309408E+02    0.76787E+00   -0.14559E+01   672   0.164E+01    0.333E+00
DAV:   8    -0.369149716753E+02    0.10676E+00   -0.23751E+00   720   0.789E+00    0.257E+00
DAV:   9    -0.368176794481E+02    0.97292E-01   -0.83486E-01   624   0.389E+00    0.758E-01
DAV:  10    -0.368195515306E+02   -0.18721E-02   -0.96874E-02   664   0.163E+00    0.338E-01
DAV:  11    -0.368168800642E+02    0.26715E-02   -0.11612E-02   680   0.476E-01    0.643E-02
DAV:  12    -0.368170302789E+02   -0.15021E-03   -0.65931E-04   704   0.157E-01    0.282E-02
DAV:  13    -0.368170320358E+02   -0.17569E-05   -0.59015E-05   680   0.377E-02    0.180E-02
DAV:  14    -0.368170304579E+02    0.15779E-05   -0.62514E-05   648   0.322E-02    0.915E-03
DAV:  15    -0.368170287191E+02    0.17388E-05   -0.14122E-05   552   0.163E-02    0.173E-03
DAV:  16    -0.368170286990E+02    0.20058E-07   -0.57590E-07   432   0.445E-03
   1 F= -.36817029E+02 E0= -.36817029E+02  d E =-.368170E+02
 curvature:   0.00 expect dE= 0.000E+00 dE for cont linesearch  0.000E+00
 trial: gam= 0.00000 g(F)=  0.273E-59 g(S)=  0.121E+02 ort = 0.000E+00 (trialstep = 0.100E+01)
 search vector abs. value=  0.121E+02
 bond charge predicted
       N       E                     dE             d eps       ncg     rms          rms(c)
DAV:   1    -0.164680007679E+03   -0.12786E+03   -0.38146E+03   512   0.518E+02    0.126E+02
DAV:   2    -0.587836475118E+02    0.10590E+03   -0.31851E+02   576   0.121E+02    0.316E+01
DAV:   3    -0.429650778765E+02    0.15819E+02   -0.48884E+01   672   0.579E+01    0.154E+01
DAV:   4    -0.423775248953E+02    0.58755E+00   -0.85382E+00   776   0.169E+01    0.128E+01
DAV:   5    -0.430400552145E+02   -0.66253E+00   -0.25708E+00   624   0.981E+00    0.259E+00
DAV:   6    -0.429620292848E+02    0.78026E-01   -0.12553E+00   704   0.710E+00    0.154E+00
DAV:   7    -0.430005706906E+02   -0.38541E-01   -0.15516E-01   720   0.216E+00    0.410E-01
DAV:   8    -0.429994866767E+02    0.10840E-02   -0.62074E-03   592   0.658E-01    0.112E-01
DAV:   9    -0.429993704375E+02    0.11624E-03   -0.93590E-04   616   0.223E-01    0.209E-02
DAV:  10    -0.429993681429E+02    0.22946E-05   -0.74439E-05   728   0.759E-02    0.231E-02
DAV:  11    -0.429993678977E+02    0.24522E-06   -0.11155E-05   584   0.257E-02    0.518E-03
DAV:  12    -0.429993683374E+02   -0.43976E-06   -0.40512E-07   352   0.544E-03
   2 F= -.42999368E+02 E0= -.42999368E+02  d E =-.618234E+01
 trial-energy change:   -6.182340  1 .order   -2.709414  -12.066452    6.647624
 step:   0.8136(harm=  0.6448)  dis= 0.00000  next Energy=   -43.596360 (dE=-0.678E+01)
 bond charge predicted
```

まだ分からないのを承知で書くと、DAVの行である原子配列に対する最適な電子分布を決めています（電子ループ）。それが定まると、各原子にかかっている力や、セルにかかっている圧力が分かるので、もっとエネルギーが下がるように原子位置やセルの形を変えます。
これが1 Fとか2 Fの行で、イオンループといいます。
これを繰り返すことで、原子に力が全くかからない状態、つまり最もエネルギー的に安定な状態を求めていきます。
これを構造最適化といいます。
構造最適化がちゃんと収束するか、上手くいかずに既定のステップ数に達したら、計算が自動的に終了します。

{{% callout warning %}}
{{< spoiler text="**研究で計算をバリバリ使うつもりの人へ**">}}
計算が始まった時には、vasp.logを開いて、何か予期せぬErrorやWarningが発生してないか**必ず確認してください**。
計算が終わった時にも、vasp.logを開いて、ちゃんと収束条件を満たして終了しているか**必ず確認してください**。
癖をつけとかないと、上手くいってない計算のデータを使ってしまって、あとで:fearful_face::face_screaming_in_fear:こんな顔をすることになります。
上手くいった場合、vasp.logの最後の方に以下の文章が出ているはずです。
```bash
 reached required accuracy - stopping structural energy minimisation
```
{{< /spoiler >}}
{{% /callout %}}

qstatで計算が終わったことが確認できたら、CONTCARというファイルをlessコマンドで見てください。
格子定数の値が変わっていることが分かると思います。
その値が実験値と大きく変わらないことを調べて確認してください。

また、OUTCARというファイルには、もっと詳しい計算経過が書いてあります。
多分ほとんど意味がわかんないと思いますが、一旦lessコマンドで開いて見てみてください。
このOUTCARから必要な部分だけ抜き出してみましょう。
例えば以下を実行してください。
```bash
grep 'external pressure' OUTCAR
```
こうすると、OUTCARの中から'external pressure'と書いてある行を抜き出せます。
各イオンステップごとの圧力が出てきて、最初は圧縮応力がかかっていたのが、最終的にほぼ圧力が0になっていることが確認できると思います。
また、以下をすると各ステップのエネルギーが抜き出せます。
```bash
grep 'energy  without' OUTCAR
```
構造最適化によって、エネルギーがどんどん下がっているのが分かると思います。
このように、元素種と構造を与えさえすれば最適な構造とそのエネルギーが求まります。
これが第一原理計算の強みの一つです。
